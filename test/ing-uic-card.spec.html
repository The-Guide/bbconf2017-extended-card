<!doctype html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../es6-promise/es6-promise.auto.min.js"></script>
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <!-- Step 1: import the element to test -->
    <link rel="import" href="../ing-uic-card.html">
    <link rel="import" href="../ing-uic-card-plug-on.html">
</head>
<body>

<!-- You can use the document as a place to set up your fixtures. -->
<test-fixture id="ing-uic-card-fixture">
    <template>
        <ing-uic-card>
            <h3 slot="header">Title</h3>
            <div slot="body">Content</div>
        </ing-uic-card>
    </template>
</test-fixture>

<test-fixture id="ing-uic-card-fixture-with-plug-on">
    <template>
        <ing-uic-card type="article">
            <h3 slot="header">Title</h3>
            <div slot="body">Content</div>
            <ing-uic-card-plug-on slot="plug-ons" href="#1">
                Link with icon
            </ing-uic-card-plug-on>
            <ing-uic-card-plug-on slot="plug-ons" href="#2" class="primary">
                Primary link
            </ing-uic-card-plug-on>
        </ing-uic-card>
    </template>
</test-fixture>

<test-fixture id="ing-uic-card-fixture-with-action-bar">
    <template>
        <ing-uic-card type="article">
            <h3 slot="header">Title</h3>
            <div slot="body">Content</div>
            <a slot="action-bar" href="#/1">
                <iron-icon icon="ing-action:view"></iron-icon>
                <span>Link with icon</span>
                <iron-icon class="icon-arrow" icon="ing-arrow:chevron-open-right"></iron-icon>
                <paper-ripple></paper-ripple>
            </a>
            <a slot="action-bar" href="#/2" class="primary-action">
                <iron-icon icon="ing-action:edit"></iron-icon>
                <span>Primary action</span>
                <iron-icon class="icon-arrow" icon="ing-arrow:chevron-open-right"></iron-icon>
                <paper-ripple></paper-ripple>
            </a>
        </ing-uic-card>
    </template>
</test-fixture>

<test-fixture id="ing-uic-card-fixture-with-deferred-plug-on">
    <template>
        <div>
            <dom-bind id="bindMe">
                <template is="dom-bind" id="bindMeV1">
                    <ing-uic-card type="article">
                        <h3 slot="header">Title</h3>
                        <div slot="body">Content</div>
                        <template is="dom-if" if="[[_showMe]]">
                            <ing-uic-card-plug-on slot="plug-ons" href="#1">
                                Link with icon
                            </ing-uic-card-plug-on>
                        </template>
                    </ing-uic-card>
                </template>
            </dom-bind>
        </div>
    </template>
</test-fixture>

<script>
    describe('ing-uic-card', function() {

        context('default card', function() {
            var element;

            beforeEach(function() {
                element = fixture('ing-uic-card-fixture');
            });

            it('elements exists', function() {
                var header = element.querySelector('[slot=header]');
                var body = element.querySelector('[slot=body]');

                expect(header).to.exist;
                expect(body).to.exist;
            });

            it('projects content', function() {
                var contentElems = element.getContentChildren();
                expect(contentElems.length).to.equal(1);
                expect(contentElems[0]).to.equal(element.querySelector('h3'));
            });

            it('has no specific classes', function() {
                var innerCard = element.$$('paper-card');
                expect(innerCard.classList.contains('ing-uic-card-article')).to.be.false;
                expect(innerCard.classList.contains('ing-uic-card-has-plug-on')).to.be.false;
            });

            it('has no plug-on', function(done) {
                flush(function() {
                    expect(element._showPlugOns).to.be.false;
                    expect(element.$$('.ing-uic-card-plug-ons').hasAttribute('hidden')).to.be.true;
                    done();
                });
            });
        });

        context('article card with plug-on', function() {
            var element;

            beforeEach(function() {
                element = fixture('ing-uic-card-fixture-with-plug-on');
            });

            it('type is set to article', function() {
                expect(element.type).to.equal('article');
            });

            it('has an plug-on', function(done) {
                flush(function() {
                    expect(element._showPlugOns).to.be.true;
                    expect(element.$$('.ing-uic-card-plug-ons').hasAttribute('hidden')).to.be.false;
                    done();
                });
            });

            it('adds the article and plug-on classes', function(done) {
                flush(function() {
                    var innerCard = element.$$('paper-card');
                    expect(innerCard.classList.contains('ing-uic-card-article')).to.be.true;
                    expect(innerCard.classList.contains('ing-uic-card-has-plug-ons')).to.be.true;
                    done();
                });
            });

            it('has exactly 2 plug-ons bars', function(done) {
                flush(function() {
                    expect(element.querySelectorAll('[slot="plug-ons"]').length).to.equal(2);
                    done();
                });
            });

            it('has 1 primary plug-on bar', function(done) {
                flush(function() {
                    expect(element.querySelectorAll('[slot="plug-ons"].primary')).to.exist;
                    done();
                });
            });

        });

        context('article card with action bar', function() {
            var element;

            beforeEach(function() {
                element = fixture('ing-uic-card-fixture-with-action-bar');
            });

            it('has exactly 2 action bars', function(done) {
                flush(function() {
                    expect(element.querySelectorAll('[slot="action-bar"]').length).to.equal(2);
                    done();
                });
            });

            it('has 1 primary action bar', function(done) {
                flush(function() {
                    expect(element.querySelectorAll('[slot="action-bar"].primary-action')).to.exist;
                    done();
                });
            });
        });

        context('article card with deferred plug-on', function() {
            var elementContainer, element, innerCard;

            beforeEach(function() {
                elementContainer = fixture('ing-uic-card-fixture-with-deferred-plug-on');
                element = elementContainer.querySelector('ing-uic-card');
                innerCard = element.$$('paper-card');
            });

            it('has no plug-on initially', function(done) {
                flush(function() {
                    expect(element._showPlugOns).to.be.false;
                    expect(element.$$('.ing-uic-card-plug-ons').hasAttribute('hidden')).to.be.true;

                    expect(innerCard.classList.contains('ing-uic-card-article')).to.be.true;
                    expect(innerCard.classList.contains('ing-uic-card-has-action-bar')).to.be.false;
                    done();
                });
            });

            it('has an plug-on when the if condition is set to true', function(done) {
                var bindMe = Polymer.Element ? 'bindMe' : 'bindMeV1';
                elementContainer.querySelector('#' + bindMe)._showMe = true;

                flush(function() {
                    expect(element._showPlugOns).to.be.true;
                    expect(element.$$('.ing-uic-card-plug-ons').hasAttribute('hidden')).to.be.false;

                    expect(innerCard.classList.contains('ing-uic-card-article')).to.be.true;
                    expect(innerCard.classList.contains('ing-uic-card-has-plug-ons')).to.be.true;
                    done();
                });
            });

        });
    });

    a11ySuite('ing-uic-card-fixture');
</script>

</body>
</html>
